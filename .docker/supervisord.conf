#!/bin/bash

# Ensure necessary directories exist
mkdir -p /var/www/storage/framework/sessions
mkdir -p /var/www/storage/framework/cache
mkdir -p /var/www/storage/framework/views
mkdir -p /var/www/storage/logs
mkdir -p /var/www/bootstrap/cache

# Set proper permissions
chown -R www-data:www-data /var/www/storage /var/www/bootstrap/cache
chmod -R ug+rwx /var/www/storage /var/www/bootstrap/cache

# Laravel setup
php /var/www/artisan config:clear
php /var/www/artisan cache:clear
php /var/www/artisan view:clear
php /var/www/artisan config:cache
php /var/www/artisan storage:link

echo "Starting Supervisord (manages php-fpm, nginx, scheduler)"
exec /usr/bin/supervisord -c /etc/supervisor/supervisord.conf